Bootstrap: docker
From: pytorch/pytorch:2.5.1-cuda11.8-cudnn9-devel

%post
    chmod 777 /tmp

    apt-get update && apt-get install -y \
        build-essential \
        libgl1-mesa-glx \
        libglib2.0-0 \
        libgtk2.0-dev \
        libnotify-dev \
        libpango1.0-dev \
        libsm-dev \
        libxext-dev \
        libxrender-dev \
        git \
        vim \
        curl

    pip install --no-cache-dir \
        anndata \
        formulaic \
        copulas \
        POT \
        lightning \
        muon \
        mudata \
        altair \
        papermill \
        pamona \
        ipython \
        ipykernel

    git clone -b gpu-scaling https://krisrs1128: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@github.com/krisrs1128/scDesigner.git
    cd scDesigner/scdesigner
    python -m pip install -v -e .

# apptainer build environment.sif environment.def