Bootstrap: docker
From: pytorch/pytorch:2.5.1-cuda11.8-cudnn9-devel

%post
    apt-get update && apt-get install -y \
        build-essential \
        libgl1-mesa-glx \
        libglib2.0-0 \
        libgtk2.0-dev \
        libnotify-dev \
        libpango1.0-dev \
        libsm-dev \
        libxext-dev \
        libxrender-dev

    pip install --no-cache-dir \
        anndata \
        formulaic \
        copulas \
        lightning \
        muon \
        mudata \
        altair \
        papermill \
        pamona \
        ipython \
        ipykernel

# from installation instructions
# https://apptainer.org/docs/admin/main/installation.html#installation-on-windows-or-mac1
# limactl start --name=apptainer-builder apptainer.yaml
# limactl shell apptainer-builder

# if running from mac, helps to follow this
# https://lima-vm.io/docs/config/multi-arch/
# https://medium.com/@soerendip/building-x86-64-apptainer-images-on-arm-based-macbooks-a-step-by-step-guide-07bbf626b7b3

